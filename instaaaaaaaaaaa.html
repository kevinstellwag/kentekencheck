<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grappige Kenteken Check App</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #0a0a0a;
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .app-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        header {
            width: 100%;
            text-align: center;
            padding: 15px 0;
            background: linear-gradient(to bottom, #1a1a1a, #0a0a0a);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        h1 {
            font-size: 2em;
            color: #4caf50;
            margin: 0;
            letter-spacing: 0.5px;
        }
        .search-section {
            width: 100%;
            max-width: 500px;
            margin-bottom: 25px;
            position: relative;
        }
        form {
            display: flex;
            align-items: center;
            background: #1f1f1f;
            border-radius: 50px;
            padding: 5px 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        input[type="text"] {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            color: #e0e0e0;
            font-size: 1em;
            text-transform: uppercase;
            outline: none;
        }
        input[type="text"]::placeholder {
            color: #888888;
            text-transform: uppercase;
        }
        button[type="submit"] {
            background: none;
            border: none;
            color: #4caf50;
            font-size: 1.2em;
            cursor: pointer;
            padding: 10px;
            transition: color 0.3s;
        }
        button[type="submit"]:hover {
            color: #66bb6a;
        }
        #result {
            width: 100%;
            max-width: 700px;
            background: #1f1f1f;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s, transform 0.5s;
            margin-bottom: 30px;
        }
        #result.show {
            opacity: 1;
            transform: translateY(0);
        }
        .tabs {
            display: flex;
            justify-content: space-around;
            background: #2a2a2a;
            border-radius: 50px;
            padding: 5px;
            margin-bottom: 20px;
        }
        .tab-button {
            padding: 10px 20px;
            background: transparent;
            color: #e0e0e0;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: background 0.3s, color 0.3s;
            font-weight: 600;
        }
        .tab-button.active {
            background: #4caf50;
            color: #0a0a0a;
        }
        .tab-content {
            display: none;
            opacity: 0;
            transform: translateX(-20px);
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
        }
        .tab-content.active {
            display: block;
            opacity: 1;
            transform: translateX(0);
        }
        .info {
            font-size: 0.95em;
            margin: 10px 0;
            color: #b0b0b0;
        }
        .fun-text {
            font-size: 1.5em;
            font-weight: 700;
            color: #4caf50;
            margin-top: 15px;
            text-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
        }
        .vehicle-image {
            width: 100%;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6);
            transition: transform 0.3s ease;
        }
        .vehicle-image:hover {
            transform: scale(1.02);
        }
        .links {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .links a {
            padding: 8px 15px;
            background: #2a2a2a;
            color: #4caf50;
            text-decoration: none;
            border-radius: 50px;
            transition: background 0.3s;
            font-size: 0.9em;
        }
        .links a:hover {
            background: #4caf50;
            color: #0a0a0a;
        }
        .specs-list {
            max-height: 250px;
            overflow-y: auto;
            padding: 10px;
            background: #252525;
            border-radius: 15px;
            font-size: 0.9em;
        }
        .save-icon {
            font-size: 1.5em;
            color: #888888;
            cursor: pointer;
            transition: color 0.3s, transform 0.3s;
            margin-top: 10px;
            display: block;
            text-align: center;
        }
        .save-icon.saved {
            color: #4caf50;
        }
        .save-icon:hover {
            color: #66bb6a;
            transform: rotate(20deg) scale(1.2);
        }
        .history-section, .favorites-section {
            width: 100%;
            max-width: 700px;
            margin-top: 20px;
        }
        .history-title, .favorites-title {
            font-size: 1.4em;
            color: #4caf50;
            margin-bottom: 15px;
            text-align: center;
        }
        .history-list, .favorites-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        .history-item {
            background: #1f1f1f;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        .history-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
        }
        .history-img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            transition: filter 0.3s;
        }
        .history-item:hover .history-img {
            filter: brightness(1.1);
        }
        .history-kenteken {
            padding: 10px;
            text-align: center;
            font-size: 0.9em;
            color: #e0e0e0;
        }
        nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #1a1a1a;
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        .nav-btn {
            background: none;
            border: none;
            color: #888888;
            font-size: 1em;
            cursor: pointer;
            transition: color 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .nav-btn.active {
            color: #4caf50;
        }
        .nav-btn i {
            font-size: 1.5em;
            margin-bottom: 5px;
            transition: transform 0.3s;
        }
        .nav-btn:hover i {
            transform: scale(1.1);
        }
        @media (max-width: 600px) {
            h1 {
                font-size: 1.8em;
            }
            .tabs {
                flex-direction: column;
                border-radius: 15px;
            }
            .tab-button {
                margin: 5px 0;
                border-radius: 15px;
            }
            .history-list, .favorites-list {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            .history-img {
                height: 100px;
            }
            nav {
                padding: 10px 0;
            }
            .nav-btn i {
                font-size: 1.3em;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <h1>Grappige Kenteken Check</h1>
        </header>
        <div class="search-section">
            <form id="kentekenForm">
                <input type="text" id="kenteken" placeholder="XX-999-XX" required>
                <button type="submit"><i class="fas fa-search"></i></button>
            </form>
        </div>
        <div id="result" style="display: none;"></div>
        <div class="history-section" style="display: none;">
            <div class="history-title">Geschiedenis</div>
            <div class="history-list" id="historyList"></div>
        </div>
        <div class="favorites-section" style="display: none;">
            <div class="favorites-title">Opgeslagen Auto's</div>
            <div class="favorites-list" id="favoritesList"></div>
        </div>
    </div>
    <nav>
        <button class="nav-btn active" onclick="showSection('result')"><i class="fas fa-home"></i>Home</button>
        <button class="nav-btn" onclick="showSection('history-section')"><i class="fas fa-history"></i>Geschiedenis</button>
        <button class="nav-btn" onclick="showSection('favorites-section')"><i class="fas fa-star"></i>Favorieten</button>
    </nav>
    <script>
        const pexelsApiKey = 'Dq9wzB4o36SxGh0KFzjXeba88WUbae0CJtmNXjwPq7IxAnjMxWGJ0VUt'; // Vervang dit door je eigen Pexels API Key

        function showSection(sectionClass) {
            document.querySelectorAll('#result, .history-section, .favorites-section').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            if (sectionClass === 'result') {
                document.getElementById('result').style.display = 'block';
            } else {
                document.querySelector(`.${sectionClass}`).style.display = 'block';
            }
            event.currentTarget.classList.add('active');
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('kentekenHistory') || '[]');
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            history.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <img src="${item.imageUrl}" alt="${item.kenteken}" class="history-img" onerror="this.src='https://via.placeholder.com/150?text=Error'">
                    <div class="history-kenteken">${item.kenteken}</div>
                `;
                div.onclick = () => {
                    document.getElementById('kenteken').value = item.kenteken;
                    document.getElementById('kentekenForm').dispatchEvent(new Event('submit'));
                };
                historyList.appendChild(div);
            });
        }

        function loadFavorites() {
            const favorites = JSON.parse(localStorage.getItem('kentekenFavorites') || '[]');
            const favoritesList = document.getElementById('favoritesList');
            favoritesList.innerHTML = '';
            favorites.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <img src="${item.imageUrl}" alt="${item.kenteken}" class="history-img" onerror="this.src='https://via.placeholder.com/150?text=Error'">
                    <div class="history-kenteken">${item.kenteken}</div>
                `;
                div.onclick = () => {
                    document.getElementById('kenteken').value = item.kenteken;
                    document.getElementById('kentekenForm').dispatchEvent(new Event('submit'));
                };
                favoritesList.appendChild(div);
            });
        }

        function addToHistory(kenteken, imageUrl) {
            let history = JSON.parse(localStorage.getItem('kentekenHistory') || '[]');
            history = history.filter(item => item.kenteken !== kenteken);
            history.unshift({ kenteken, imageUrl });
            if (history.length > 20) history.pop();
            localStorage.setItem('kentekenHistory', JSON.stringify(history));
            loadHistory();
        }

        function toggleFavorite(kenteken, imageUrl, icon) {
            let favorites = JSON.parse(localStorage.getItem('kentekenFavorites') || '[]');
            const index = favorites.findIndex(item => item.kenteken === kenteken);
            if (index > -1) {
                favorites.splice(index, 1);
                icon.classList.remove('saved');
            } else {
                favorites.push({ kenteken, imageUrl });
                icon.classList.add('saved');
            }
            localStorage.setItem('kentekenFavorites', JSON.stringify(favorites));
            loadFavorites();
        }

        function isFavorite(kenteken) {
            const favorites = JSON.parse(localStorage.getItem('kentekenFavorites') || '[]');
            return favorites.some(item => item.kenteken === kenteken);
        }

        async function fetchWithTimeout(url, options, timeout = 5000) {
            return Promise.race([
                fetch(url, options),
                new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), timeout))
            ]);
        }

        document.getElementById('kentekenForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const kentekenInput = document.getElementById('kenteken').value.toUpperCase().replace(/-/g, '');
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p class="info">Laden...</p>';
            resultDiv.style.display = 'block';
            resultDiv.classList.remove('show');
            showSection('result');
            setTimeout(() => resultDiv.classList.add('show'), 10);

            try {
                const voertuigResponse = await fetchWithTimeout(`https://opendata.rdw.nl/resource/m9d7-ebf2.json?kenteken=${kentekenInput}`, {}, 5000);
                const voertuigData = await voertuigResponse.json();
                
                if (voertuigData.length === 0) {
                    resultDiv.innerHTML = '<p class="info">Geen voertuig gevonden met dit kenteken.</p>';
                    return;
                }

                const vehicle = voertuigData[0];
                const merk = vehicle.merk || 'Onbekend';
                const model = vehicle.handelsbenaming || 'Onbekend';
                const bouwjaar = vehicle.datum_eerste_toelating ? new Date(vehicle.datum_eerste_toelating).getFullYear() : 'Onbekend';
                const kleur = vehicle.eerste_kleur ? vehicle.eerste_kleur.toLowerCase() : '';
                const catalogusprijs = vehicle.catalogusprijs || 'Onbekend';

                const brandstofResponse = await fetchWithTimeout(`https://opendata.rdw.nl/resource/8ys7-d773.json?kenteken=${kentekenInput}`, {}, 5000);
                const brandstofData = await brandstofResponse.json();
                
                let vermogenKW = 0;
                if (brandstofData.length > 0) {
                    const brandstof = brandstofData[0];
                    if (brandstof.brandstof_omschrijving === 'Elektriciteit') {
                        vermogenKW = parseFloat(brandstof.netto_max_vermogen_elektrisch) || 0;
                    } else {
                        vermogenKW = parseFloat(brandstof.nettomaximumvermogen) || 0;
                    }
                }

                const vermogenPK = Math.round(vermogenKW * 1.36);

                let funText = '';
                if (vermogenPK <= 150) {
                    funText = 'Sloom kanker ding';
                } else if (vermogenPK <= 250) {
                    funText = 'Kanker hard trappen dit ding!';
                } else {
                    funText = 'Kanker snel bro';
                }

                const cilinders = vehicle.aantal_cilinders || 'Onbekend';
                const cilinderInhoud = vehicle.cilinderinhoud || 'Onbekend';
                const deuren = vehicle.aantal_deuren || 'Onbekend';
                const zitplaatsen = vehicle.aantal_zitplaatsen || 'Onbekend';
                const wielbasis = vehicle.wielbasis || 'Onbekend';
                const lengte = vehicle.lengte || 'Onbekend';
                const breedte = vehicle.breedte || 'Onbekend';
                const hoogte = vehicle.hoogte_voertuig || 'Onbekend';
                const massaLedig = vehicle.massa_ledig_voertuig || 'Onbekend';
                const maxMassa = vehicle.toegestane_maximum_massa_voertuig || 'Onbekend';
                const inrichting = vehicle.inrichting || 'Onbekend';
                const voertuigsoort = vehicle.voertuigsoort || 'Onbekend';
                const bpm = vehicle.bruto_bpm || 'Onbekend';
                const wamVerzekerd = vehicle.wam_verzekerd || 'Onbekend';
                const type = vehicle.type || 'Onbekend';
                const variant = vehicle.variant || 'Onbekend';
                const uitvoering = vehicle.uitvoering || 'Onbekend';
                const exportIndicator = vehicle.export_indicator || 'Onbekend';
                const openstaandeTerugroepactie = vehicle.openstaande_terugroepactie_indicator || 'Onbekend';
                const taxiIndicator = vehicle.taxi_indicator || 'Onbekend';
                const tellerstandoordeel = vehicle.tellerstandoordeel || 'Onbekend';

                // Haal afbeelding op via Pexels API met timeout
                let imageUrl = 'https://via.placeholder.com/800x600?text=Afbeelding+niet+gevonden';
                try {
                    const pexelsResponse = await fetchWithTimeout(`https://api.pexels.com/v1/search?query=${encodeURIComponent(`stock photo of ${merk} ${model} ${bouwjaar} ${kleur} car`)}&per_page=1&orientation=landscape`, {
                        headers: {
                            Authorization: pexelsApiKey
                        }
                    }, 5000); // 5 second timeout
                    const pexelsData = await pexelsResponse.json();
                    if (pexelsData.photos && pexelsData.photos.length > 0) {
                        imageUrl = pexelsData.photos[0].src.large;
                    }
                } catch (error) {
                    console.error('Pexels API error or timeout:', error);
                }

                const googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(merk + ' ' + model + ' review')}`;
                const autoWeekUrl = `https://www.autoweek.nl/autotests/?zoekterm=${encodeURIComponent(merk + ' ' + model)}`;
                const marktplaatsUrl = `https://www.marktplaats.nl/q/${encodeURIComponent(merk.toLowerCase() + ' ' + model.toLowerCase() + ' ' + bouwjaar)}`;
                const mrbCalculatorUrl = `https://www.belastingdienst.nl/wps/wcm/connect/nl/auto-en-vervoer/content/hulpmiddel-motorrijtuigenbelasting-berekenen`;

                const savedClass = isFavorite(kentekenInput) ? 'saved' : '';

                resultDiv.innerHTML = `
                    <div class="tabs">
                        <button class="tab-button active" onclick="openTab(event, 'basis')">Basis</button>
                        <button class="tab-button" onclick="openTab(event, 'specs')">Specs</button>
                        <button class="tab-button" onclick="openTab(event, 'prijs')">Prijs</button>
                    </div>
                    <div id="basis" class="tab-content active">
                        <img src="${imageUrl}" alt="${merk} ${model}" class="vehicle-image" onerror="this.src='https://via.placeholder.com/800x600?text=Afbeelding+niet+gevonden'">
                        <p class="info"><strong>Merk:</strong> ${merk}</p>
                        <p class="info"><strong>Model:</strong> ${model}</p>
                        <p class="info"><strong>Bouwjaar:</strong> ${bouwjaar}</p>
                        <p class="info"><strong>Kleur:</strong> ${kleur}</p>
                        <p class="info"><strong>Vermogen:</strong> ${vermogenPK} PK</p>
                        <div class="fun-text">${funText}</div>
                        <i class="fas fa-star save-icon ${savedClass}" onclick="toggleFavorite('${kentekenInput}', '${imageUrl}', this)"></i>
                    </div>
                    <div id="specs" class="tab-content">
                        <div class="specs-list">
                            <p class="info"><strong>Aantal Cilinders:</strong> ${cilinders}</p>
                            <p class="info"><strong>Cilinder Inhoud:</strong> ${cilinderInhoud} cc</p>
                            <p class="info"><strong>Aantal Deuren:</strong> ${deuren}</p>
                            <p class="info"><strong>Zitplaatsen:</strong> ${zitplaatsen}</p>
                            <p class="info"><strong>Wielbasis:</strong> ${wielbasis} cm</p>
                            <p class="info"><strong>Lengte:</strong> ${lengte} cm</p>
                            <p class="info"><strong>Breedte:</strong> ${breedte} cm</p>
                            <p class="info"><strong>Hoogte:</strong> ${hoogte} cm</p>
                            <p class="info"><strong>Massa Ledig:</strong> ${massaLedig} kg</p>
                            <p class="info"><strong>Max Massa:</strong> ${maxMassa} kg</p>
                            <p class="info"><strong>Inrichting:</strong> ${inrichting}</p>
                            <p class="info"><strong>Voertuigsoort:</strong> ${voertuigsoort}</p>
                            <p class="info"><strong>Bruto BPM:</strong> ${bpm} €</p>
                            <p class="info"><strong>WAM Verzekerd:</strong> ${wamVerzekerd}</p>
                            <p class="info"><strong>Type:</strong> ${type}</p>
                            <p class="info"><strong>Variant:</strong> ${variant}</p>
                            <p class="info"><strong>Uitvoering:</strong> ${uitvoering}</p>
                            <p class="info"><strong>Export Indicator:</strong> ${exportIndicator}</p>
                            <p class="info"><strong>Openstaande Terugroepactie:</strong> ${openstaandeTerugroepactie}</p>
                            <p class="info"><strong>Taxi Indicator:</strong> ${taxiIndicator}</p>
                            <p class="info"><strong>Tellerstand Oordeel:</strong> ${tellerstandoordeel}</p>
                        </div>
                        <div class="links">
                            <a href="${googleSearchUrl}" target="_blank">Reviews</a>
                            <a href="${autoWeekUrl}" target="_blank">AutoWeek</a>
                            <a href="${marktplaatsUrl}" target="_blank">Marktplaats</a>
                        </div>
                    </div>
                    <div id="prijs" class="tab-content">
                        <p class="info"><strong>Nieuwe Prijs:</strong> ${catalogusprijs} €</p>
                        <p class="info"><strong>Maandelijkse Kosten:</strong> Afhankelijk van MRB, etc.</p>
                        <div class="links">
                            <a href="${mrbCalculatorUrl}" target="_blank">MRB Berekenen</a>
                        </div>
                        <p class="info">Vergelijk verzekeringen via Independer of Pricewise.</p>
                    </div>
                `;
                addToHistory(kentekenInput, imageUrl);
            } catch (error) {
                resultDiv.innerHTML = '<p class="info">Er ging iets mis bij het ophalen van de gegevens.</p>';
            } finally {
                // Zorg ervoor dat loading stopt, zelfs bij errors
                if (resultDiv.innerHTML === '<p class="info">Laden...</p>') {
                    resultDiv.innerHTML = '<p class="info">Laden mislukt. Probeer opnieuw.</p>';
                }
            }
        });

        function openTab(evt, tabName) {
            const tabContents = evt.currentTarget.parentElement.parentElement.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            const tabButtons = evt.currentTarget.parentElement.getElementsByClassName('tab-button');
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
        }

        loadHistory();
        loadFavorites();
        showSection('result');
    </script>
</body>
</html>